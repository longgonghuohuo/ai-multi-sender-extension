# 更新指南

## 我做了什么改进？

### 1. 修复了检测问题 ✅
- 添加了超时处理机制（500ms）
- 改进了错误处理逻辑
- 添加了详细的日志输出
- 修复了 URL 检查可能为空的问题

### 2. 全新的全页面界面 🎨
- 更大的输入区域
- 实时显示 AI 状态卡片
- 更美观的渐变设计
- 更好的视觉反馈
- 响应式布局，支持各种屏幕尺寸

### 3. 改进的用户体验 💫
- 发送时显示加载动画
- 更详细的成功/失败提示
- 自动保存输入内容
- 快捷键支持（Ctrl/Cmd + Enter）
- 每 3 秒自动刷新 AI 状态

## 如何更新？

### 方法一：直接刷新（最简单）

1. 打开 `chrome://extensions/`
2. 找到 AI Multi Sender
3. 点击「刷新」图标（🔄）
4. 完成！

### 方法二：重新加载（如果刷新不起作用）

1. 打开 `chrome://extensions/`
2. 找到 AI Multi Sender
3. 点击「移除」
4. 点击「加载已解压的扩展程序」
5. 选择 `/Users/gusuping/ai-multi-sender-extension` 文件夹
6. 完成！

## 新界面预览

现在插件使用的是全页面模式（fullpage.html），包含：

- **左侧**：大号文本输入框，可以输入更长的问题
- **右侧**：实时显示三个 AI 的状态
  - 绿色 = 已就绪，可以发送
  - 灰色 = 未检测到，需要打开网页
- **底部**：
  - 大号「发送到所有 AI」按钮
  - 清空按钮
  - 使用提示

## 测试步骤

### 1. 更新插件后测试

```
1. 刷新插件
2. 点击插件图标
3. 应该看到新的全页面界面
4. 检查是否显示「检测中...」然后变成具体状态
```

### 2. 测试检测功能

```
1. 打开 https://chat.openai.com
2. 打开 https://claude.ai
3. 打开 https://gemini.google.com
4. 点击插件图标
5. 等待 1-2 秒
6. 应该看到对应的卡片变成绿色
7. 显示「X 个标签页已就绪」
```

### 3. 测试发送功能

```
1. 在输入框输入：「你好，请介绍一下自己」
2. 点击「发送到所有 AI」按钮
3. 应该看到：
   - 按钮变成「正在发送...」
   - 出现加载动画
   - 1-2 秒后显示成功消息
4. 切换到各个 AI 标签页
5. 检查问题是否已填充到输入框
```

## 如果还是检测不到？

请按照 DEBUG.md 中的步骤排查：

### 快速检查清单

- [ ] 已刷新插件
- [ ] AI 网页已完全加载
- [ ] 已登录各个 AI 服务
- [ ] 处于对话页面（不是设置页）
- [ ] 打开 F12 查看 Console 有无错误
- [ ] 在 Console 看到「content script loaded」消息

### 常见原因

1. **Content Script 未加载**
   - 解决：刷新 AI 网页

2. **消息传递失败**
   - 解决：刷新插件

3. **页面结构变化**
   - 解决：检查 Console 错误信息

4. **权限问题**
   - 解决：检查 manifest.json 的 host_permissions

## 技术细节

### 改进的检测逻辑

```javascript
// 添加了超时处理
const timeout = setTimeout(() => resolve(), 500);

// 检查 URL 是否存在
if (tab.url && tab.url.includes('chat.openai.com')) {
  // ...
}

// 清理超时
clearTimeout(timeout);
```

### 全页面模式的优势

- 更大的工作区域
- 不会因为弹窗关闭而丢失状态
- 更好的视觉反馈
- 支持更复杂的交互

## 版本对比

| 功能 | 旧版本（popup） | 新版本（fullpage） |
|------|----------------|-------------------|
| 窗口大小 | 400px × 小 | 1200px × 大 |
| 输入区域 | 120px 高 | 300px 高 |
| 状态显示 | 简单文本 | 彩色卡片 |
| 加载动画 | 无 | 有 |
| 超时处理 | 2秒 | 500ms |
| 错误提示 | 简单 | 详细 |

## 下一步

如果你想切换回小窗口模式：

1. 编辑 `manifest.json`
2. 将第 19 行：
   ```json
   "default_popup": "fullpage.html",
   ```
   改为：
   ```json
   "default_popup": "popup.html",
   ```
3. 刷新插件

---

有任何问题请查看 DEBUG.md 或反馈给我！
